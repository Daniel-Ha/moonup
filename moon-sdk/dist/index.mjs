import{AUTH as s}from"@moonup/moon-types";var p=n=>{switch(n.AuthType){case s.OAUTH2:return{type:s.OAUTH2,securityWorker:async t=>({headers:{Authorization:`Bearer ${t.token}`}}),CLIENT_ID:n.CLIENT_ID,CLIENT_SECRET:n.CLIENT_SECRET,REDIRECT_URI:n.REDIRECT_URI};case s.JWT:return{type:s.JWT,securityWorker:async t=>Promise.resolve({headers:{Authorization:`Bearer ${t.token}`}})};case s.X_API_KEY:return{type:s.X_API_KEY,securityWorker:async t=>({headers:{"x-api-key":`${t.token}`}})};default:return{type:s.JWT,securityWorker:async t=>({headers:{Authorization:`Bearer ${t.token}`}})}}};import{EventEmitter as g}from"events";var m=(o=>(o.login="MOON_LOGIN",o.logout="MOON_LOGOUT",o))(m||{}),u=class{constructor(){this.EventEmitter=new g}emit(t,o){this.EventEmitter.emit(t,o)}async handle(t){return this.EventEmitter.emit(t.type,t.data),{type:t.type,data:t.data}}};import{BigNumber as a}from"@ethersproject/bignumber";import{arrayify as l}from"@ethersproject/bytes";import{hashMessage as y}from"@ethersproject/hash";import{Aave as K,Accounts as A,Auth as f,Bitcoin as k,Bitcoincash as M,ContentType as e,Conveyorfinance as T,Cosmos as d,Dogecoin as b,Ens as E,Eos as v,Erc1155 as C,Erc20 as w,Erc4337 as W,Erc721 as R,Litecoin as P,Oneinch as U,Ripple as B,Solana as J,Tron as I,Uniswap as N,Yearn as O}from"@moonup/moon-api";import{MOON_SUPPORTED_NETWORKS as j,MoonAccount as h,MoonStorage as L}from"@moonup/moon-types";var S=class{constructor(t){this.MoonSDKConfig=this.initialiseConfig(t),this.MoonAccount=new h(this.MoonSDKConfig.Storage),this.MoonMessageHandler=new u,this.AccountsSDK=new A({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.AuthSDK=new f({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"}}),this.AaveSDK=new K({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.ENSSDK=new E({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc20SDK=new w({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc1155SDK=new C({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc721SDK=new R({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc4337SDK=new W({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.OneinchSDK=new U({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.UniswapSDK=new N({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.YearnSDK=new O({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.ConveyorfinanceSDK=new T({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.BitcoinSDK=new k({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.BitcoincashSDK=new M({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.DogecoinSDK=new b({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.SolanaSDK=new J({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.CosmosSDK=new d({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.EosSDK=new v({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.LitecoinSDK=new P({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.RippleSDK=new B({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.TronSDK=new I({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:e.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker})}login(){this.getMoonAccount().login(),this.updateToken(this.getMoonAccount().getToken())}getSolanaSDK(){return this.SolanaSDK}getBitcoinSDK(){return this.BitcoinSDK}getCosmosSDK(){return this.CosmosSDK}getEosSDK(){return this.EosSDK}getLitecoinSDK(){return this.LitecoinSDK}getRippleSDK(){return this.RippleSDK}getTronSDK(){return this.TronSDK}getBitcoincashSDK(){return this.BitcoincashSDK}getDogecoinSDK(){return this.DogecoinSDK}getAuthSDK(){return this.AuthSDK}getAccountsSDK(){return this.AccountsSDK}getAaveSDK(){return this.AaveSDK}getConveyorfinanceSDK(){return this.ConveyorfinanceSDK}getENSSDK(){return this.ENSSDK}getErc20SDK(){return this.Erc20SDK}getErc1155SDK(){return this.Erc1155SDK}getErc721SDK(){return this.Erc721SDK}getErc4337SDK(){return this.Erc4337SDK}getOneinchSDK(){return this.OneinchSDK}getUniswapSDK(){return this.UniswapSDK}getYearnSDK(){return this.YearnSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.YearnSDK}getMoonAccount(){return this.MoonAccount}updateRefreshToken(t){this.MoonAccount.setRefreshToken(t)}updateToken(t){this.MoonAccount.setToken(t),this.BitcoinSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.AccountsSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.AaveSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.ConveyorfinanceSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.ENSSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc20SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc1155SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc721SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc4337SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.OneinchSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.UniswapSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.SolanaSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.CosmosSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.EosSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.LitecoinSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.RippleSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.TronSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.BitcoincashSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.DogecoinSDK.setSecurityData({token:this.MoonAccount.getToken()})}async refreshAccount(){let t=this.MoonAccount.getRefreshToken(),o=await this.getAuthSDK().refreshToken({refreshToken:t});return this.updateToken(o.data.accessToken),o.data}async listAccounts(){let t=await this.getAccountsSDK().listAccounts();if(!t.ok)throw new Error(t.statusText);return t.data}transactionRequestToInputBody(t){return{chain_id:a.from(t.chainId).toString(),data:t.data,to:t.to,gasPrice:a.from(t.gasPrice).toString(),gas:a.from(t.gasLimit).toString(),nonce:a.from(t.nonce).toString(),value:t.value&&a.from(t.value).toString(),encoding:"utf-8"}}moonTransactionResponseToTransactions(t){return t.transactions||[]}async SignTransaction(t){return await this.getAccountsSDK().signTransaction(this.MoonAccount.getWallet(),this.transactionRequestToInputBody(t)).then(i=>{if(!i.ok)throw new Error(i.statusText);return this.moonTransactionResponseToTransactions(i.data.data)?.at(0)?.raw_transaction})||""}async SignMessage(t){let o=new Uint8Array(l(y(t)));return(await this.getAccountsSDK().signMessage(this.MoonAccount.getWallet(),{data:o.toString(),encoding:"utf-8"}).then(r=>{if(!r.ok)throw new Error(r.statusText);return r.data.data})).signed_message||""}async SignTypedData(t,o,i){return(await this.getAccountsSDK().signTypedData(this.MoonAccount.getWallet(),{data:JSON.stringify({domain:t,types:o,value:i})}).then(c=>{if(!c.ok)throw new Error(c.statusText);return c.data.data})).signed_message||""}async SendTransaction(t){let o=await this.getAccountsSDK().broadcastTx(this.MoonAccount.getWallet(),{rawTransaction:t,chainId:this.MoonAccount.getNetwork().chainId});if(!o.ok)throw new Error(o.statusText);return o.data.data}initialiseConfig(t){return{Auth:p(t.Auth),Storage:new L(t.Storage.type,t.Storage.key),Networks:t.Networks||j}}updateConfig(t){this.MoonSDKConfig=this.initialiseConfig(t)}getNetworks(){return this.MoonSDKConfig.Networks}updateAccount(t){this.MoonAccount=t,this.MoonSDKConfig.Storage.setItem(t)}updateWallet(t){this.MoonAccount.setWallet(t),this.MoonSDKConfig.Storage.setItem(this.MoonAccount)}async connect(){let t=new h(this.MoonSDKConfig.Storage);if(this.getMoonAccount().login(),t.getToken()!=""&&t.getRefreshToken()!=""&&t.getExpiry()<Date.now()){let o=await this.refreshAccount();this.updateToken(o.accessToken)}return new h(this.MoonSDKConfig.Storage)}updateNetwork(t){this.MoonAccount.setNetwork(t)}async disconnect(){}async logout(){this.MoonAccount.logout()}};var D=class{constructor(t,o){this.container=t;this.url=o;this.iframe=document.createElement("iframe"),this.iframe.src=this.url,this.iframe.style.width="100%",this.iframe.style.height="100%",this.container.appendChild(this.iframe)}setUrl(t){this.url=t,this.iframe&&(this.iframe.src=this.url)}destroy(){this.container&&this.iframe&&this.container.removeChild(this.iframe)}sendMessage(t){this.iframe&&this.iframe.contentWindow&&this.iframe.contentWindow.postMessage(t,this.url)}};export{D as IframeController,u as MoonMessageHandler,m as MoonMessageType,S as MoonSDK,p as moonAuthConfig};
//# sourceMappingURL=index.mjs.map