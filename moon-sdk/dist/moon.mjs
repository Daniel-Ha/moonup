import{BigNumber as a}from"@ethersproject/bignumber";import{arrayify as g}from"@ethersproject/bytes";import{hashMessage as K}from"@ethersproject/hash";import{Aave as y,Accounts as A,Auth as l,Bitcoin as m,Bitcoincash as k,ContentType as o,Conveyorfinance as f,Cosmos as M,Dogecoin as T,Ens as b,Eos as E,Erc1155 as C,Erc20 as d,Erc4337 as v,Erc721 as w,Litecoin as W,Oneinch as R,Ripple as P,Solana as U,Tron as B,Uniswap as J,Yearn as I}from"@moonup/moon-api";import{MOON_SUPPORTED_NETWORKS as N,MoonAccount as h,MoonStorage as O}from"@moonup/moon-types";import{AUTH as n}from"@moonup/moon-types";var p=s=>{switch(s.AuthType){case n.OAUTH2:return{type:n.OAUTH2,securityWorker:async t=>({headers:{Authorization:`Bearer ${t.token}`}}),CLIENT_ID:s.CLIENT_ID,CLIENT_SECRET:s.CLIENT_SECRET,REDIRECT_URI:s.REDIRECT_URI};case n.JWT:return{type:n.JWT,securityWorker:async t=>Promise.resolve({headers:{Authorization:`Bearer ${t.token}`}})};case n.X_API_KEY:return{type:n.X_API_KEY,securityWorker:async t=>({headers:{"x-api-key":`${t.token}`}})};default:return{type:n.JWT,securityWorker:async t=>({headers:{Authorization:`Bearer ${t.token}`}})}}};import{EventEmitter as D}from"events";var u=class{constructor(){this.EventEmitter=new D}emit(t,e){this.EventEmitter.emit(t,e)}async handle(t){return this.EventEmitter.emit(t.type,t.data),{type:t.type,data:t.data}}};var S=class{constructor(t){this.MoonSDKConfig=this.initialiseConfig(t),this.MoonAccount=new h(this.MoonSDKConfig.Storage),this.MoonMessageHandler=new u,this.AccountsSDK=new A({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.AuthSDK=new l({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"}}),this.AaveSDK=new y({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.ENSSDK=new b({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc20SDK=new d({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc1155SDK=new C({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc721SDK=new w({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.Erc4337SDK=new v({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.OneinchSDK=new R({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.UniswapSDK=new J({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.YearnSDK=new I({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.ConveyorfinanceSDK=new f({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.BitcoinSDK=new m({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.BitcoincashSDK=new k({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.DogecoinSDK=new T({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.SolanaSDK=new U({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.CosmosSDK=new M({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.EosSDK=new E({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.LitecoinSDK=new W({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.RippleSDK=new P({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker}),this.TronSDK=new B({baseUrl:"https://vault-api.usemoon.ai",baseApiParams:{secure:!0,type:o.Json,format:"json"},securityWorker:this.MoonSDKConfig.Auth.securityWorker})}login(){this.getMoonAccount().login(),this.updateToken(this.getMoonAccount().getToken())}getSolanaSDK(){return this.SolanaSDK}getBitcoinSDK(){return this.BitcoinSDK}getCosmosSDK(){return this.CosmosSDK}getEosSDK(){return this.EosSDK}getLitecoinSDK(){return this.LitecoinSDK}getRippleSDK(){return this.RippleSDK}getTronSDK(){return this.TronSDK}getBitcoincashSDK(){return this.BitcoincashSDK}getDogecoinSDK(){return this.DogecoinSDK}getAuthSDK(){return this.AuthSDK}getAccountsSDK(){return this.AccountsSDK}getAaveSDK(){return this.AaveSDK}getConveyorfinanceSDK(){return this.ConveyorfinanceSDK}getENSSDK(){return this.ENSSDK}getErc20SDK(){return this.Erc20SDK}getErc1155SDK(){return this.Erc1155SDK}getErc721SDK(){return this.Erc721SDK}getErc4337SDK(){return this.Erc4337SDK}getOneinchSDK(){return this.OneinchSDK}getUniswapSDK(){return this.UniswapSDK}getYearnSDK(){return this.YearnSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.YearnSDK}getMoonAccount(){return this.MoonAccount}updateRefreshToken(t){this.MoonAccount.setRefreshToken(t)}updateToken(t){this.MoonAccount.setToken(t),this.BitcoinSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.AccountsSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.AaveSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.ConveyorfinanceSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.ENSSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc20SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc1155SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc721SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.Erc4337SDK.setSecurityData({token:this.MoonAccount.getToken()}),this.OneinchSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.UniswapSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.SolanaSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.CosmosSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.EosSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.LitecoinSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.RippleSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.TronSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.BitcoincashSDK.setSecurityData({token:this.MoonAccount.getToken()}),this.DogecoinSDK.setSecurityData({token:this.MoonAccount.getToken()})}async refreshAccount(){let t=this.MoonAccount.getRefreshToken(),e=await this.getAuthSDK().refreshToken({refreshToken:t});return this.updateToken(e.data.accessToken),e.data}async listAccounts(){let t=await this.getAccountsSDK().listAccounts();if(!t.ok)throw new Error(t.statusText);return t.data}transactionRequestToInputBody(t){return{chain_id:a.from(t.chainId).toString(),data:t.data,to:t.to,gasPrice:a.from(t.gasPrice).toString(),gas:a.from(t.gasLimit).toString(),nonce:a.from(t.nonce).toString(),value:t.value&&a.from(t.value).toString(),encoding:"utf-8"}}moonTransactionResponseToTransactions(t){return t.transactions||[]}async SignTransaction(t){return await this.getAccountsSDK().signTransaction(this.MoonAccount.getWallet(),this.transactionRequestToInputBody(t)).then(r=>{if(!r.ok)throw new Error(r.statusText);return this.moonTransactionResponseToTransactions(r.data.data)?.at(0)?.raw_transaction})||""}async SignMessage(t){let e=new Uint8Array(g(K(t)));return(await this.getAccountsSDK().signMessage(this.MoonAccount.getWallet(),{data:e.toString(),encoding:"utf-8"}).then(i=>{if(!i.ok)throw new Error(i.statusText);return i.data.data})).signed_message||""}async SignTypedData(t,e,r){return(await this.getAccountsSDK().signTypedData(this.MoonAccount.getWallet(),{data:JSON.stringify({domain:t,types:e,value:r})}).then(c=>{if(!c.ok)throw new Error(c.statusText);return c.data.data})).signed_message||""}async SendTransaction(t){let e=await this.getAccountsSDK().broadcastTx(this.MoonAccount.getWallet(),{rawTransaction:t,chainId:this.MoonAccount.getNetwork().chainId});if(!e.ok)throw new Error(e.statusText);return e.data.data}initialiseConfig(t){return{Auth:p(t.Auth),Storage:new O(t.Storage.type,t.Storage.key),Networks:t.Networks||N}}updateConfig(t){this.MoonSDKConfig=this.initialiseConfig(t)}getNetworks(){return this.MoonSDKConfig.Networks}updateAccount(t){this.MoonAccount=t,this.MoonSDKConfig.Storage.setItem(t)}updateWallet(t){this.MoonAccount.setWallet(t),this.MoonSDKConfig.Storage.setItem(this.MoonAccount)}async connect(){let t=new h(this.MoonSDKConfig.Storage);if(this.getMoonAccount().login(),t.getToken()!=""&&t.getRefreshToken()!=""&&t.getExpiry()<Date.now()){let e=await this.refreshAccount();this.updateToken(e.accessToken)}return new h(this.MoonSDKConfig.Storage)}updateNetwork(t){this.MoonAccount.setNetwork(t)}async disconnect(){}async logout(){this.MoonAccount.logout()}};export{S as MoonSDK};
//# sourceMappingURL=moon.mjs.map